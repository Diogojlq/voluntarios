{% extends "vol/base_nosidebar.html" %}
{% load staticfiles %}

{% block title %}Cadastro de Entidade{% endblock title %}

{% block head %}

<script type="text/javascript" src="{% static 'js/jquery.formset.js' %}"></script>

<script type="text/javascript">
    $(function() {
        $('.telformset').formset({formCssClass: 'telformset', prefix: 'tel_set', deleteText: 'remover', addText: 'incluir outro'});
        $('.emailformset').formset({formCssClass: 'emailformset', prefix: 'email_set', deleteCssClass: 'delete-row-distinct', addCssClass: 'add-row-distinct', deleteText: 'remover', addText: 'incluir outro'});
    });
</script>

{% endblock head %}

{% block content %}

<h1 class="margin-bottom">{% if form.instance.id %}Cadastro de Entidade{% else %}Nova Entidade{% endif %}</h1>

{% include "vol/mensagens.html" %}

{% include "vol/erros.html" %}

{% spaceless %}
 {% for error in telformset.errors %}
  {% for msg in error.values %}<p><font face="Verdana" size="2" color="red">{{ msg }}</font></p>{% endfor %}
 {% endfor %}
 {% for error in emailformset.errors %}
  {% for msg in error.values %}<p><font face="Verdana" size="2" color="red">{{ msg }}</font></p>{% endfor %}
 {% endfor %}
{% endspaceless %}

<form id="form-entidade" method="POST" action="">{% csrf_token %}

{% include "vol/campo_formulario.html" with campo=form.nome_fantasia %}
{% include "vol/campo_formulario.html" with campo=form.razao_social %}
{% include "vol/campo_formulario.html" with campo=form.cnpj %}
{% include "vol/campo_formulario.html" with campo=form.area_atuacao %}
{% include "vol/campo_formulario.html" with campo=form.descricao %}
{% include "vol/campo_formulario.html" with campo=form.num_vol %}
{% include "vol/campo_formulario.html" with campo=form.num_vol_ano %}

{% include "vol/campo_formulario.html" with campo=form.website %}

<fieldset>
<legend>Responsável</legend>
{% include "vol/campo_formulario.html" with campo=form.nome_resp %}
{% include "vol/campo_formulario.html" with campo=form.sobrenome_resp %}
{% include "vol/campo_formulario.html" with campo=form.cargo_resp %}
</fieldset>

<fieldset>
<legend>Endereço</legend>
{% include "vol/campo_formulario.html" with campo=form.cep %}
{% include "vol/campo_formulario.html" with campo=form.logradouro %}
{% include "vol/campo_formulario.html" with campo=form.bairro %}
{% include "vol/campo_formulario.html" with campo=form.cidade %}
{% include "vol/campo_formulario.html" with campo=form.estado %}
</fieldset>

<fieldset>
<legend>Contato</legend>

<label>Telefones</label>
{{ telformset.management_form }}
<div class="table-responsive form-group required{% if telformset.errors %} has-error{% endif %}">
<table width="100%" class="table table-condensed">
 <tr> 
  <th width="10%">{{ telformset.forms.0.fields.tipo.label }}</th>
  <th width="10%">{{ telformset.forms.0.fields.prefixo.label }}</th>
  <th width="80%">{{ telformset.forms.0.fields.numero.label }}</th>
 </tr>
 {% for telform in telformset %}
 <tr class="telformset">
  <td>{{ telform.id }}{{ telform.tipo }}</td>
  <td>{{ telform.prefixo }}</td>
  <td>{{ telform.numero }}{{ telform.DELETE }}</td>
 </tr>
 {% endfor %}
</table>
</div>

<label>E-mails</label>
{{ emailformset.management_form }}
<div class="table-responsive form-group required{% if emailformset.errors %} has-error{% endif %}">
<table width="100%" class="table table-condensed">
 <tr> 
  <th>{{ emailformset.forms.0.fields.endereco.label }}</th>
  <th width="100px">{{ emailformset.forms.0.fields.principal.label }}</th>
 </tr>
 {% for emailform in emailformset %}
 <tr class="emailformset">
  <td>{{ emailform.id }}{{ emailform.endereco }}</td>
  <td>{{ emailform.principal }}{{ emailform.DELETE }}</td>
 </tr>
 {% endfor %}
</table>
</div>

{% include "vol/campo_formulario.html" with campo=form.nome_contato %}
</fieldset>

<div class="form-group">
  <input class="btn btn-primary" type="submit" name="submit" value="{% if form.instance.id %}Gravar alterações{% else %}Cadastrar{% endif %}">
  {% if form.instance.id %}
  <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#confirm-delete">Remover</button>
  {% endif %}
</div>

{% if form.instance.id %} 
<div class="modal" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
     <div class="modal-content">
            
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="myModalLabel">Confirme a remoção</h4>
        </div>
            
        <div class="modal-body">
            <p>Tem certeza que deseja remover esta entidade?</p>
        </div>
                
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Não</button>
            <input class="btn btn-danger btn-ok" type="submit" name="delete" value="Sim">
        </div>
     </div>
  </div>
</div>
{% endif %}

</form>

<script type="text/javascript">
    $("input.input-principal").click(function() {
        var selected_id = $(this).attr('id');
        $("input.input-principal").each(function( index ) {
            if ($(this).attr('id') !== selected_id) {
                $(this).prop('checked', false);
            }
        });
    });
</script> 

{% endblock content %}
